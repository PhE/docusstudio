{"_path":"/docs/team/services/auth/checkout","_dir":"auth","_draft":false,"_partial":false,"_locale":"","title":"checkout","description":"We use stripe to handle payment (one shot and subscriptions).","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"checkout"},"children":[{"type":"text","value":"checkout"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We use "},{"type":"element","tag":"a","props":{"href":"https://stripe.com","rel":["nofollow"]},"children":[{"type":"text","value":"stripe"}]},{"type":"text","value":" to handle payment (one shot and subscriptions)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"See our "},{"type":"element","tag":"a","props":{"href":"stripe"},"children":[{"type":"text","value":"stripe page"}]},{"type":"text","value":" for details about Stripe integration."}]},{"type":"element","tag":"h2","props":{"id":"checkout-1"},"children":[{"type":"text","value":"checkout"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"API call to checkout : "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/api/checkout/session"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For a single checkout (buying credits) we give a "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"qty"}]},{"type":"text","value":" param (quantity of credit needed)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Subscription checkout (recurrent credits amount) we give a "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"price_id"}]},{"type":"text","value":" param\n(an existing stripe price id)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"!!! important\nThe credit system is not used anymore\nand will be deprecated soon."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If a "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"redirect"}]},{"type":"text","value":" param is given, upon stripe callback the redirect will occur\n(the redirect could be relative to the nuxt front app).\nthe default "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"redirect"}]},{"type":"text","value":"is "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/front/checkout/success"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sample call for a one shot 12 credits buy :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/api/checkout/session?qty=12"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sample call for a subscription :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/api/checkout/session?price_id=price_1KqDAWK0npsJqs8Ma6zyHflo"}]}]},{"type":"element","tag":"h2","props":{"id":"prices-page"},"children":[{"type":"text","value":"prices page"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The price page could contain a subscription button with a link to :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/api/checkout/session?price_id={STRIPE_PRICE_ID}"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"STRIPE_PRICE_ID"}]},{"type":"text","value":" is a Stripe price ID of the form "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"price_xxxx"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This is an example link :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/api/checkout/session?price_id=price_1KqDAWK0npsJqs8Ma6zyHflo"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Following this link will bring the user to a Stripe checkout/payment page.\nAfter a successfull payment Stripe will bring the user back to a paxpar page."}]},{"type":"element","tag":"h2","props":{"id":"credit-reset"},"children":[{"type":"text","value":"credit reset"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Subscription wil reset the credit counter on each payment."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"!!! important\nThe credit system is not use anymore\nand will be deprecated soon."}]},{"type":"element","tag":"h2","props":{"id":"stripe-webhooks"},"children":[{"type":"text","value":"Stripe webhooks"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The stripe account must have webhook endpoint defined and pointing to\n"},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/api/checkout/webhook"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Supported message type :"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"checkout.session.completed"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"invoice.paid"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"invoice.payment_failed"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A single stripe account can serve payment for several paxpar instances.\nSo an endpoint is defined for each paxpar instance."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"A payment will then trigger multiple webhook (one per paxpar instance)."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The subscription/checkout session contains the paxpar FQDN instance (like dev.paxpar.tech or prod.paxpar.tech)\nin the metadata."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The auth service recieving the webhook will ignore it if the paxpar FQDN does not match."}]},{"type":"element","tag":"h2","props":{"id":"stripe-local-test"},"children":[{"type":"text","value":"stripe local test"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install "},{"type":"element","tag":"a","props":{"href":"https://github.com/stripe/stripe-cli/releases","rel":["nofollow"]},"children":[{"type":"text","value":"stripe cli"}]},{"type":"text","value":" and stripe VS code extension."}]},{"type":"element","tag":"pre","props":{"code":"wget https://github.com/stripe/stripe-cli/releases/download/v1.8.6/stripe_1.8.6_linux_amd64.deb\nsudo dpkg -i stripe_1.8.6_linux_amd64.deb\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"wget https://github.com/stripe/stripe-cli/releases/download/v1.8.6/stripe_1.8.6_linux_amd64.deb\nsudo dpkg -i stripe_1.8.6_linux_amd64.deb\n"}]}]},{"type":"element","tag":"pre","props":{"code":"stripe login\nstripe listen --forward-to localhost:4242/webhook\nstripe listen --forward-to [2a01:4f9:2a:25d5::17]:8883/api/checkout/webhook\n\nstripe trigger invoice.payment_succeeded\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"stripe login\nstripe listen --forward-to localhost:4242/webhook\nstripe listen --forward-to [2a01:4f9:2a:25d5::17]:8883/api/checkout/webhook\n\nstripe trigger invoice.payment_succeeded\n"}]}]},{"type":"element","tag":"h2","props":{"id":"misc"},"children":[{"type":"text","value":"misc"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The envvar "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"WEBHOOK_SECRET"}]},{"type":"text","value":" must be set !"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"checkout-1","depth":2,"text":"checkout"},{"id":"prices-page","depth":2,"text":"prices page"},{"id":"credit-reset","depth":2,"text":"credit reset"},{"id":"stripe-webhooks","depth":2,"text":"Stripe webhooks"},{"id":"stripe-local-test","depth":2,"text":"stripe local test"},{"id":"misc","depth":2,"text":"misc"}]}},"_type":"markdown","_id":"content:10.docs:80.team:10.services:auth:checkout.md","_source":"content","_file":"10.docs/80.team/10.services/auth/checkout.md","_extension":"md"}