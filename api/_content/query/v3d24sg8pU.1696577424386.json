{"_path":"/docs/team/services/auth","_dir":"services","_draft":false,"_partial":false,"_locale":"","title":"auth core service","description":"","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"auth-core-service"},"children":[{"type":"text","value":"auth core service"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"img","props":{"alt":"","src":"auth.drawio.svg"},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sequence diagram for a new user subscription :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"!!! important\nThe following sequence diagram is outdated !!"}]},{"type":"element","tag":"pre","props":{"code":"sequenceDiagram\n    actor User as User browser\n\n    autonumber\n    User->>nuxt: vitrine\n    activate nuxt\n    User->>nuxt: /pricing\n    User->>nuxt: /checkout?price_id=price_xxx\n    nuxt->>nuxt: see login diagram\n    nuxt->>+fastapi: POST /api/checkout/session?price_id=price_xxx\n    fastapi->>Stripe: create checkout session\n    fastapi->>-nuxt: redirect to Stripe\n    nuxt->>+User: redirect to Stripe\n    deactivate nuxt\n\n    rect rgba(200, 0, 0, .1)\n    note right of nuxt: Stripe checkout\n\n        User->>-Stripe: redirect to stripe checkout\n        activate Stripe\n        User->>Stripe: card numbers\n        User->>Stripe: address and other infos\n        Stripe->>Stripe: check and pay\n        Stripe->>+User: redirect to /api/checkout/success callback\n        deactivate Stripe\n\n    end\n\n    User->>-fastapi: redirect to /api/checkout/success\n    activate fastapi\n    fastapi->>postgre: update user info\n    fastapi->>+User: redirect to /checkout/success\n    deactivate fastapi\n    User->>-nuxt: redirect to /checkout/success\n    nuxt->>nuxt: go to initial target\n\n    rect rgba(200, 0, 0, .1)\n    note right of fastapi: later Stripe webhook\n\n        Stripe->>+fastapi: /api/checkout/webhook\n        fastapi->>-postgre: update user info (if not)\n\n    end\n","language":"mermaid","meta":"","className":"language-mermaid shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"sequenceDiagram"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    actor"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":" User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":" as"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" User browser"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    autonumber"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" vitrine"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    activate"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":" nuxt"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" /pricing"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" /checkout?price_id=price_xxx"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" see login diagram"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>+"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" POST /api/checkout/session?price_id=price_xxx"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" create checkout session"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>-"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" redirect to Stripe"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>+"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" redirect to Stripe"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    deactivate"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":" nuxt"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    rect"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" rgba(200, 0, 0, .1)"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    note right of nuxt: Stripe checkout"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"        User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>-"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" redirect to stripe checkout"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"        activate"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":" Stripe"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"        User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" card numbers"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"        User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" address and other infos"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"        Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" check and pay"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"        Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>+"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" redirect to /api/checkout/success callback"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"        deactivate"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":" Stripe"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    end"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>-"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" redirect to /api/checkout/success"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    activate"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":" fastapi"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"postgre"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" update user info"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>+"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" redirect to /checkout/success"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    deactivate"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":" fastapi"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>-"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" redirect to /checkout/success"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" go to initial target"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    rect"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" rgba(200, 0, 0, .1)"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    note right of fastapi: later Stripe webhook"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"        Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>+"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" /api/checkout/webhook"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"        fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>-"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"postgre"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" update user info (if not)"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"    end"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"!!! important\nThe following sequence diagram is outdated !!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sequence diagram for the auth/login steps :"}]},{"type":"element","tag":"pre","props":{"code":"sequenceDiagram\n    User->>nuxt: to a protected page\n    nuxt->>nuxt: /front/login?redirect=xxx\n    nuxt->>Magic: login req\n    Magic->>User: email\n    nuxt->>nuxt: wait\n    User->>Magic: click email\n    Magic->>nuxt: confirmation\n    nuxt->>fastapi: /api/auth/login\n    fastapi->>postgre: user info\n    postgre->>fastapi: user info\n    fastapi->>nuxt: redirect to xxx\n","language":"mermaid","meta":"","className":"language-mermaid shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"sequenceDiagram"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" to a protected page"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" /front/login?redirect=xxx"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Magic"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" login req"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    Magic"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" email"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" wait"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Magic"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" click email"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    Magic"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" confirmation"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" /api/auth/login"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"postgre"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" user info"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    postgre"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" user info"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" redirect to xxx"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"!!! important\nThe following sequence diagram is outdated !!"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sequence diagram for a subscription of a new user :"}]},{"type":"element","tag":"pre","props":{"code":"sequenceDiagram\n    User->>hugo: vitrine\n    User->>hugo: offre tarif\n    hugo->>nuxt: /front/checkout\n    nuxt->>nuxt: /front/login\n    User->>nuxt: email\n    nuxt->>Magic: login req\n    Magic->>User: email\n    nuxt->>nuxt: wait\n    User->>Magic: click email\n    Magic->>nuxt: confirmation\n    nuxt->>fastapi: /api/auth/login\n    fastapi->>postgre: user info\n    postgre->>fastapi: user info\n    fastapi->>nuxt: user info\n    nuxt->>fastapi: /api/checkout/create-session ??\n    nuxt->>Stripe: stripe/pay\n    User->>Stripe: card numbers\n    Stripe->>Stripe: check and pay\n    Stripe->>nuxt: checkout/sucess\n    Stripe->>fastapi: /api/checkout/webhook\n    fastapi->>postgre: update user info\n","language":"mermaid","meta":"","className":"language-mermaid shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"sequenceDiagram"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"hugo"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" vitrine"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"hugo"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" offre tarif"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    hugo"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" /front/checkout"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" /front/login"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" email"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Magic"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" login req"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    Magic"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" email"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" wait"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Magic"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" click email"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    Magic"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" confirmation"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" /api/auth/login"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"postgre"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" user info"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    postgre"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" user info"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" user info"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" /api/checkout/create-session ??"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" stripe/pay"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    User"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" card numbers"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" check and pay"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"nuxt"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" checkout/sucess"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    Stripe"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" /api/checkout/webhook"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"    fastapi"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"->>"}]},{"type":"element","tag":"span","props":{"style":"color:#E36209;--shiki-dark:#FFAB70"},"children":[{"type":"text","value":"postgre"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" update user info"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"url-sequence-v3"},"children":[{"type":"text","value":"URL sequence v3"}]},{"type":"element","tag":"h2","props":{"id":"url-sequence-v2"},"children":[{"type":"text","value":"URL sequence v2"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"URL sequence (with examples from "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"dev17.paxpar.tech"}]},{"type":"text","value":" instance):"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"site"}]},{"type":"text","value":" : page containing prices"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://dev17.paxpar.tech/site#pricing","rel":["nofollow"]},"children":[{"type":"text","value":"https://dev17.paxpar.tech/site#pricing"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"buy.stripe.com"}]},{"type":"text","value":" : stripe paymentlink a given product/price/plan"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://buy.stripe.com/test_5kAbMr51h3Ba6T6aEG","rel":["nofollow"]},"children":[{"type":"text","value":"https://buy.stripe.com/test_5kAbMr51h3Ba6T6aEG"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"api/checkout/session"}]},{"type":"text","value":" : stripe payment link callback, register plan and redirect"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://dev17.paxpar.tech/api/checkout/session/%7BCHECKOUT_SESSION_ID%7D","rel":["nofollow"]},"children":[{"type":"text","value":"https://dev17.paxpar.tech/api/checkout/session/{CHECKOUT_SESSION_ID}"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"front/login"}]},{"type":"text","value":" : redirection to login page with email and autologin"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"inner API calls to "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"POST /api/auth/login"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"GET /api/auth/me"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://dev17.paxpar.tech/front/login?email=...&redirect=/front/checkout/success?auto","rel":["nofollow"]},"children":[{"type":"text","value":"https://dev17.paxpar.tech/front/login?email=...&redirect=/front/checkout/success?auto"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"front/checkout/success"}]},{"type":"text","value":" : redirect made by auto login"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://dev17.paxpar.tech/front/checkout/success","rel":["nofollow"]},"children":[{"type":"text","value":"https://dev17.paxpar.tech/front/checkout/success"}]}]}]},{"type":"element","tag":"h2","props":{"id":"url-sequence-v1"},"children":[{"type":"text","value":"URL sequence v1"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"URL sequence (with examples from "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"dev.document.legal"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"dev17.paxpar.tech"}]},{"type":"text","value":" instances):"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"site"}]},{"type":"text","value":" : page containing prices"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://dev17.paxpar.tech/site","rel":["nofollow"]},"children":[{"type":"text","value":"https://dev17.paxpar.tech/site"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"front/checkout"}]},{"type":"text","value":" : checkout page for a given product/price/plan"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://dev17.paxpar.tech/front/checkout?productId=price_1J2tgBFvDsHBMRpKoR0jcqKn","rel":["nofollow"]},"children":[{"type":"text","value":"https://dev17.paxpar.tech/front/checkout?productId=price_1J2tgBFvDsHBMRpKoR0jcqKn"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://dev.document.legal/front/checkout?productId=price_1HKkwbFvDsHBMRpKSsl1TapG","rel":["nofollow"]},"children":[{"type":"text","value":"https://dev.document.legal/front/checkout?productId=price_1HKkwbFvDsHBMRpKSsl1TapG"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"front/login"}]},{"type":"text","value":" : redirection to login page made by auth navigation guard"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"inner API calls to "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"POST /api/auth/login"}]},{"type":"text","value":" and "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"GET /api/auth/me"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://dev17.paxpar.tech/front/login","rel":["nofollow"]},"children":[{"type":"text","value":"https://dev17.paxpar.tech/front/login"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://dev.document.legal/front/login","rel":["nofollow"]},"children":[{"type":"text","value":"https://dev.document.legal/front/login"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"front/checkout"}]},{"type":"text","value":" : create session and redirect to stripe"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"inner API call to "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"POST /api/checkout/create-session"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"stripe/pay"}]},{"type":"text","value":" : redirection to stripe page made by "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"/front/checkout"}]},{"type":"text","value":" page"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"inner API call (webhook) to  "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":" POST /api/checkout/webhook"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://checkout.stripe.com/pay/cs_test_a1jzk2uNwmOWtQfkvZIOCYqfNFxw1kE5YfD2O4cAsPqTv7WIIPTSw9ICXi#fidkdWxOYHwnPyd1blpxYHZxWk9PbWF9fEZXT2AyQHJKalRwRlU2bnY2TzU1XWpRdF9BU2EnKSdobGF2Jz9%2BJ2JwbGEnPyc2YDxmZ2A1YSg0ZmE0KDEzMTIoZDBgNihgYGAzZjZhNjc8YTcyNT1kMjYnKSdocGxhJz8nNjA9NTJhYWQoZ2A1NygxM2M1KGQ0NDIoYzxnYDAzYTRjNjMxMzFjPTQ2JykndmxhJz8nN2A8YzxnMGMoMzcxNSgxYDVkKDwxZmMoNjVjYzdgZDxmYzQ3PDM3Zz1jJ3gpJ2dgcWR2Jz9eWCknaWR8anBxUXx1YCc%2FJ3Zsa2JpYFpscWBoJyknd2BjYHd3YHdKd2xibGsnPydtcXF1dj8qKmFgczQyK3VkfXVkdytxYGZtJ3gl","rel":["nofollow"]},"children":[{"type":"text","value":"https://checkout.stripe.com/pay/cs_test_a1jzk2uNwmOWtQfkvZIOCYqfNFxw1kE5YfD2O4cAsPqTv7WIIPTSw9ICXi#fidkdWxOYHwnPyd1blpxYHZxWk9PbWF9fEZXT2AyQHJKalRwRlU2bnY2TzU1XWpRdF9BU2EnKSdobGF2Jz9%2BJ2JwbGEnPyc2YDxmZ2A1YSg0ZmE0KDEzMTIoZDBgNihgYGAzZjZhNjc8YTcyNT1kMjYnKSdocGxhJz8nNjA9NTJhYWQoZ2A1NygxM2M1KGQ0NDIoYzxnYDAzYTRjNjMxMzFjPTQ2JykndmxhJz8nN2A8YzxnMGMoMzcxNSgxYDVkKDwxZmMoNjVjYzdgZDxmYzQ3PDM3Zz1jJ3gpJ2dgcWR2Jz9eWCknaWR8anBxUXx1YCc%2FJ3Zsa2JpYFpscWBoJyknd2BjYHd3YHdKd2xibGsnPydtcXF1dj8qKmFgczQyK3VkfXVkdytxYGZtJ3gl"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://checkout.stripe.com/pay/cs_test_a1M9i9xO64fBhXEFjzOfYJveBUlzROAtbYrXk1ep7CIWNGxYe2rY7Mnhyt#fidkdWxOYHwnPyd1blpxYHZxWk9PbWF9fEZXT2AyQHJKalRwRlU2bnY2TzU1XWpRdF9BU2EnKSdobGF2Jz9%2BJ2JwbGEnPydLRCcpJ2hwbGEnPydLRCcpJ3ZsYSc%2FJ0tEJ3gpJ2dgcWR2Jz9eWCknaWR8anBxUXx1YCc%2FJ3Zsa2JpYFpscWBoJyknd2BjYHd3YHdKd2xibGsnPydtcXF1dj8qKmFgcythamZwaGBrcStpYGJkaSd4JSUl","rel":["nofollow"]},"children":[{"type":"text","value":"https://checkout.stripe.com/pay/cs_test_a1M9i9xO64fBhXEFjzOfYJveBUlzROAtbYrXk1ep7CIWNGxYe2rY7Mnhyt#fidkdWxOYHwnPyd1blpxYHZxWk9PbWF9fEZXT2AyQHJKalRwRlU2bnY2TzU1XWpRdF9BU2EnKSdobGF2Jz9%2BJ2JwbGEnPydLRCcpJ2hwbGEnPydLRCcpJ3ZsYSc%2FJ0tEJ3gpJ2dgcWR2Jz9eWCknaWR8anBxUXx1YCc%2FJ3Zsa2JpYFpscWBoJyknd2BjYHd3YHdKd2xibGsnPydtcXF1dj8qKmFgcythamZwaGBrcStpYGJkaSd4JSUl"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"front/checkout/success"}]},{"type":"text","value":" : redirect made by stripe"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://dev17.paxpar.tech/front/checkout/success?session_id=cs_test_a1jzk2uNwmOWtQfkvZIOCYqfNFxw1kE5YfD2O4cAsPqTv7WIIPTSw9ICXi","rel":["nofollow"]},"children":[{"type":"text","value":"https://dev17.paxpar.tech/front/checkout/success?session_id=cs_test_a1jzk2uNwmOWtQfkvZIOCYqfNFxw1kE5YfD2O4cAsPqTv7WIIPTSw9ICXi"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://dev.document.legal/front/checkout/success?session_id=cs_test_a1M9i9xO64fBhXEFjzOfYJveBUlzROAtbYrXk1ep7CIWNGxYe2rY7Mnhyt","rel":["nofollow"]},"children":[{"type":"text","value":"https://dev.document.legal/front/checkout/success?session_id=cs_test_a1M9i9xO64fBhXEFjzOfYJveBUlzROAtbYrXk1ep7CIWNGxYe2rY7Mnhyt"}]}]}]},{"type":"element","tag":"h2","props":{"id":"obsolete"},"children":[{"type":"text","value":"obsolete ??"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To generate a password hash :"}]},{"type":"element","tag":"pre","props":{"code":">>> from passlib.context import CryptContext\n>>> pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\n>>> password = \"Hello\"\n>>> pwd_context.hash(password)\n'$2b$12$Pse3ooN4zO8Rl8Y4EA7l9OnrAR1/GKHkME/YQr3kJXGRxKx.01QnG'\n>>> pwd_context.hash(password)\n'$2b$12$QiJOoROc4Utyp7jEvN4vSecGum6RliIwA80eewrO1flo/VGq4jP5C'\n>>> pwd_context.hash(password)\n'$2b$12$z/l6OHJwTk/Taft3faPS9OmlhBkbSC9/W4uJms7OMtdAB0UNspX.y'\n>>>\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":">>> from passlib.context import CryptContext\n>>> pwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\n>>> password = \"Hello\"\n>>> pwd_context.hash(password)\n'$2b$12$Pse3ooN4zO8Rl8Y4EA7l9OnrAR1/GKHkME/YQr3kJXGRxKx.01QnG'\n>>> pwd_context.hash(password)\n'$2b$12$QiJOoROc4Utyp7jEvN4vSecGum6RliIwA80eewrO1flo/VGq4jP5C'\n>>> pwd_context.hash(password)\n'$2b$12$z/l6OHJwTk/Taft3faPS9OmlhBkbSC9/W4uJms7OMtdAB0UNspX.y'\n>>>\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TODO :"}]},{"type":"element","tag":"ul","props":{"className":["contains-task-list"]},"children":[{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":false,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" implement DELETE /api/auth/password/reset"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":false,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" implement POST /api/auth/password/change"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":false,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" vuetify form for login"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":false,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" vuetify form for register"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":false,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" register behaviour (mail)"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":false,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" notification component"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":false,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" nuxt publicurl/basepath"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":false,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" test token renew"}]},{"type":"element","tag":"li","props":{"className":["task-list-item"]},"children":[{"type":"element","tag":"input","props":{"checked":false,"disabled":true,"type":"checkbox"},"children":[]},{"type":"text","value":" integrate in portal (caddy)"}]}]},{"type":"element","tag":"h2","props":{"id":"local-dev-session"},"children":[{"type":"text","value":"local dev session"}]},{"type":"element","tag":"pre","props":{"code":"# set portal as a full TLS webserver\nexport PORTAL_MAIN_MODE=tls\n# set auth proxy to localhost\nexport SVC_AUTH_PROXY=localhost\n# set front service to  proxy at localhost\nexport SVC_FRONT_MODE=proxy\nexport SVC_FRONT_PROXY=localhost\n# start portal service\nmake dev-portal\n# start front service in another term\nmake dev-front\n# start auth proxy in another term\nmake dev-auth\n","language":"shell","meta":"","className":"language-shell shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"color:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# set portal as a full TLS webserver"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" PORTAL_MAIN_MODE"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"tls"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"color:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# set auth proxy to localhost"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" SVC_AUTH_PROXY"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"localhost"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"color:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# set front service to  proxy at localhost"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" SVC_FRONT_MODE"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"proxy"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"export"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":" SVC_FRONT_PROXY"}]},{"type":"element","tag":"span","props":{"style":"color:#D73A49;--shiki-dark:#F97583"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"localhost"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"color:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# start portal service"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"color:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" dev-portal"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"color:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# start front service in another term"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"color:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" dev-front"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"color:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# start auth proxy in another term"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"color:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" dev-auth"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"misc"},"children":[{"type":"text","value":"misc"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To run a script"}]},{"type":"element","tag":"pre","props":{"code":"cd services/auth\nPYTHONPATH=../.. poetry run python -m services.auth.dbrun\nPYTHONPATH=../.. poetry run python -m services.auth.dbrun2\nPYTHONPATH=../.. poetry run python -m services.auth.stripe_sample\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"cd services/auth\nPYTHONPATH=../.. poetry run python -m services.auth.dbrun\nPYTHONPATH=../.. poetry run python -m services.auth.dbrun2\nPYTHONPATH=../.. poetry run python -m services.auth.stripe_sample\n"}]}]},{"type":"element","tag":"h2","props":{"id":"pg-admin"},"children":[{"type":"text","value":"pg admin"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"use "},{"type":"element","tag":"a","props":{"href":"https://www.pgadmin.org/docs/pgadmin4/latest/container_deployment.html","rel":["nofollow"]},"children":[{"type":"text","value":"pgadmin docker image"}]},{"type":"text","value":" :"}]},{"type":"element","tag":"pre","props":{"code":"docker pull dpage/pgadmin4\ndocker run -p 80:80 \\\n    -e 'PGADMIN_DEFAULT_EMAIL=info@paxpar.tech' \\\n    -e 'PGADMIN_DEFAULT_PASSWORD=xxxx' \\\n    -d dpage/pgadmin4\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"docker pull dpage/pgadmin4\ndocker run -p 80:80 \\\n    -e 'PGADMIN_DEFAULT_EMAIL=info@paxpar.tech' \\\n    -e 'PGADMIN_DEFAULT_PASSWORD=xxxx' \\\n    -d dpage/pgadmin4\n"}]}]},{"type":"element","tag":"h2","props":{"id":"jwt-token"},"children":[{"type":"text","value":"JWT token"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We use the RS256 algorithm with a key pair."}]},{"type":"element","tag":"pre","props":{"code":"ssh-keygen -t rsa -b 2048 -f mykey\nopenssl rsa -in mykey -pubout -outform PEM -out mykey.pub\ncat mykey\ncat mykey.pub\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"ssh-keygen -t rsa -b 2048 -f mykey\nopenssl rsa -in mykey -pubout -outform PEM -out mykey.pub\ncat mykey\ncat mykey.pub\n"}]}]},{"type":"element","tag":"pre","props":{"code":"from jose import jwt, jwk\n\nkey = jwk.JWK.generate(kty='RSA', size=2048, alg='RSA-OAEP-256', use='enc', kid='12345')\npublic_key = key.export_public()\nprivate_key = key.export_private()\n\n\n\nPRIVATE_KEY = '''-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAQEA0Bwae/G6a/SasBVpRjfOyzCsRec7F8HMts4rO++wHJISr7nsZf7C\nqJfZyCB4xjQa17tdppLB8vxVJnVE5T2qWf2rcyLr3tmQ0SrPmPZzhWxLD8V9ZI/dk1Uh0q\nqhtz1yaCJftmf3v0umnDteYvnB6Crwkk07Jos2bUCz0+b88B8M1mlV+sFgjr1cmq6Ywa0c\nPEP28O5ZnZo+d/lXr4YazCOsOZ1mWdWRjhy/cKwoi2W7pnxaz8+sp03zcpzedblWeph+Yw\nrx+IeXkCuxTcKE7POvxZyQCXDpWMRD/q0GO6QTIR1L4Opqb5NiqiVO7P0RGMgivtMAaI1S\nG4lQHNiRLQAAA9AashyhGrIcoQAAAAdzc2gtcnNhAAABAQDQHBp78bpr9JqwFWlGN87LMK\nxF5zsXwcy2zis777AckhKvuexl/sKol9nIIHjGNBrXu12mksHy/FUmdUTlPapZ/atzIuve\n2ZDRKs+Y9nOFbEsPxX1kj92TVSHSqqG3PXJoIl+2Z/e/S6acO15i+cHoKvCSTTsmizZtQL\nPT5vzwHwzWaVX6wWCOvVyarpjBrRw8Q/bw7lmdmj53+VevhhrMI6w5nWZZ1ZGOHL9wrCiL\nZbumfFrPz6ynTfNynN51uVZ6mH5jCvH4h5eQK7FNwoTs86/FnJAJcOlYxEP+rQY7pBMhHU\nvg6mpvk2KqJU7s/REYyCK+0wBojVIbiVAc2JEtAAAAAwEAAQAAAQBbc/4veYry5gsUVlRt\nBxlZMYqDLZpKVmAf9XoKXMqHw6lyj8HTEKF6dUC/MYXhlAQ3yZ7eFKAmp7zDqcUc+HxkD5\nXIgxAkXnfFc4rHLYaWm4Bg7eisyIwWstKqQVHPtLESEgj9n7K/3f7ZqT1RQXB1Fmmh4U6d\nIZBJcqWT+W4uFqsvRyhW3BRgFxMyWP/86HwNdQtti6L94D9M4DT66ucc3FTqknHZYWc0HA\nymX8ACH5QfeVTwQcDhftRX75Hyzw5E9ba4lzxRvQEjhbesmDf0AsTOxnyIpqFojUChbnNg\nbY8ZWa98LfFiziExy46rtjBV4a5V8dcsqPoqzKN/Iy4BAAAAgEw0eOLX6MPE70Ni0N/iAM\n3qoiKPLMdOoVytlWCFRELor2UbzbSFUMcuCkGOJAVBzFK1vC5DFiaX3UbZ4JAetPPUxfMi\nX0nPfaOSQR18obepsxy8jQgCzEd+n/ExJDRMxVsWGb4uE8lWKMA7WjbxakaZ3w6Jky+18l\n58gj68RGGOAAAAgQD+7oV2mPQ0/XMpsr+BEZz/zMBP9QW+zmnKa7iHXpFfZ4dHSelCURug\nTiZfvDWZnaPk3ViCvXpzH19I4MYjg3RiSKckihJKqnTawLZLakeas54aL/nsv0wevWjGoB\nKKKg48Xc4xg9wFbH1dBp5TvUoBT4ZKZlLpznzAuD0HgA6hHwAAAIEA0Ptaj3iEiXffXFnj\nRG9rMiSNq8vqu7hnqR9QueNyJ2mzRrlPMd3jd1EACcf6xKwN31PUTXZBchtG7zPv9TyAG9\nbimSbI9ydytkNzcxg+21L7Md99jz50D+BY2R1U5S5OTisNmitNIt9AFZF+cZfDT2T4/WXe\nH27T66pZPbLqiDMAAAAZcm9vdEBzY3ctaW5zcGlyaW5nLWhvb3ZlcgEC\n-----END OPENSSH PRIVATE KEY-----\n'''\ntoken = jwt.encode({'a': 'b'}, PRIVATE_KEY, algorithm='RS256')\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"from jose import jwt, jwk\n\nkey = jwk.JWK.generate(kty='RSA', size=2048, alg='RSA-OAEP-256', use='enc', kid='12345')\npublic_key = key.export_public()\nprivate_key = key.export_private()\n\n\n\nPRIVATE_KEY = '''-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAQEA0Bwae/G6a/SasBVpRjfOyzCsRec7F8HMts4rO++wHJISr7nsZf7C\nqJfZyCB4xjQa17tdppLB8vxVJnVE5T2qWf2rcyLr3tmQ0SrPmPZzhWxLD8V9ZI/dk1Uh0q\nqhtz1yaCJftmf3v0umnDteYvnB6Crwkk07Jos2bUCz0+b88B8M1mlV+sFgjr1cmq6Ywa0c\nPEP28O5ZnZo+d/lXr4YazCOsOZ1mWdWRjhy/cKwoi2W7pnxaz8+sp03zcpzedblWeph+Yw\nrx+IeXkCuxTcKE7POvxZyQCXDpWMRD/q0GO6QTIR1L4Opqb5NiqiVO7P0RGMgivtMAaI1S\nG4lQHNiRLQAAA9AashyhGrIcoQAAAAdzc2gtcnNhAAABAQDQHBp78bpr9JqwFWlGN87LMK\nxF5zsXwcy2zis777AckhKvuexl/sKol9nIIHjGNBrXu12mksHy/FUmdUTlPapZ/atzIuve\n2ZDRKs+Y9nOFbEsPxX1kj92TVSHSqqG3PXJoIl+2Z/e/S6acO15i+cHoKvCSTTsmizZtQL\nPT5vzwHwzWaVX6wWCOvVyarpjBrRw8Q/bw7lmdmj53+VevhhrMI6w5nWZZ1ZGOHL9wrCiL\nZbumfFrPz6ynTfNynN51uVZ6mH5jCvH4h5eQK7FNwoTs86/FnJAJcOlYxEP+rQY7pBMhHU\nvg6mpvk2KqJU7s/REYyCK+0wBojVIbiVAc2JEtAAAAAwEAAQAAAQBbc/4veYry5gsUVlRt\nBxlZMYqDLZpKVmAf9XoKXMqHw6lyj8HTEKF6dUC/MYXhlAQ3yZ7eFKAmp7zDqcUc+HxkD5\nXIgxAkXnfFc4rHLYaWm4Bg7eisyIwWstKqQVHPtLESEgj9n7K/3f7ZqT1RQXB1Fmmh4U6d\nIZBJcqWT+W4uFqsvRyhW3BRgFxMyWP/86HwNdQtti6L94D9M4DT66ucc3FTqknHZYWc0HA\nymX8ACH5QfeVTwQcDhftRX75Hyzw5E9ba4lzxRvQEjhbesmDf0AsTOxnyIpqFojUChbnNg\nbY8ZWa98LfFiziExy46rtjBV4a5V8dcsqPoqzKN/Iy4BAAAAgEw0eOLX6MPE70Ni0N/iAM\n3qoiKPLMdOoVytlWCFRELor2UbzbSFUMcuCkGOJAVBzFK1vC5DFiaX3UbZ4JAetPPUxfMi\nX0nPfaOSQR18obepsxy8jQgCzEd+n/ExJDRMxVsWGb4uE8lWKMA7WjbxakaZ3w6Jky+18l\n58gj68RGGOAAAAgQD+7oV2mPQ0/XMpsr+BEZz/zMBP9QW+zmnKa7iHXpFfZ4dHSelCURug\nTiZfvDWZnaPk3ViCvXpzH19I4MYjg3RiSKckihJKqnTawLZLakeas54aL/nsv0wevWjGoB\nKKKg48Xc4xg9wFbH1dBp5TvUoBT4ZKZlLpznzAuD0HgA6hHwAAAIEA0Ptaj3iEiXffXFnj\nRG9rMiSNq8vqu7hnqR9QueNyJ2mzRrlPMd3jd1EACcf6xKwN31PUTXZBchtG7zPv9TyAG9\nbimSbI9ydytkNzcxg+21L7Md99jz50D+BY2R1U5S5OTisNmitNIt9AFZF+cZfDT2T4/WXe\nH27T66pZPbLqiDMAAAAZcm9vdEBzY3ctaW5zcGlyaW5nLWhvb3ZlcgEC\n-----END OPENSSH PRIVATE KEY-----\n'''\ntoken = jwt.encode({'a': 'b'}, PRIVATE_KEY, algorithm='RS256')\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"OBSOLETE (for HS256) :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Generate the JWT secret :"}]},{"type":"element","tag":"pre","props":{"code":"openssl rand -hex 32\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"openssl rand -hex 32\n"}]}]},{"type":"element","tag":"h1","props":{"id":"todo"},"children":[{"type":"text","value":"TODO"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TODO: login failed dialog when login API is not 200"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TODO: login failed dialog when /auth/me API is not 200"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"TODO: call /api/auth/logout on logout (move magic logout from front to back)"}]},{"type":"element","tag":"h1","props":{"id":"authentication-misc"},"children":[{"type":"text","value":"Authentication misc"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Authentication is based en JWT tokens."}]},{"type":"element","tag":"h2","props":{"id":"user-authentication"},"children":[{"type":"text","value":"User authentication"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The user give its credentials (email/password).\nWhen it is verified a token is forged."}]},{"type":"element","tag":"h2","props":{"id":"jwt-token-1"},"children":[{"type":"text","value":"JWT token"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Expire at a time delta of "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"conf.JWT_ACCESS_TOKEN_EXPIRE_MINUTES"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sample payload ("},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"auth.models.TokenAccessPayload"}]},{"type":"text","value":") :"}]},{"type":"element","tag":"pre","props":{"code":"email: bob@acme.com\ndomain:  uat.paxpar.tech\nplans:\n    - planA\n    - planB\nroles:\n    planA:\n        - role11\n        - role2\n    planB:\n        - role11\n        - role5\n        - role7\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"color:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"email"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"bob@acme.com"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"color:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"domain"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":  "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"uat.paxpar.tech"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"color:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"plans"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"planA"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"    - "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"planB"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"color:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"roles"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"color:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    planA"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"role11"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"role2"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"style":"color:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"    planB"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":":"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"role11"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"role5"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":"        - "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"role7"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sample token :"}]},{"type":"element","tag":"pre","props":{"code":"token='WyIweGNhZmYyYzNlZGVhMzQwMjZhMjkyMzlmZGU5OGNmOGMyZDA5YTQzNGUyMDQzOTAyYTU5N2FmMGFlMjljYWFiMTQ3MTcyZGNlM2Y3MzJkMjVlMGU5MWI4YjQ4OTMwYWYyYmMxZTU2NDEyZjY4NmJmMzhmMjRlMjdhMGEzYzQ5ZDRlMWMiLCJ7XCJpYXRcIjoxNjIxNjQyNzQyLFwiZXh0XCI6MTYyMTY0MzY0MixcImlzc1wiOlwiZGlkOmV0aHI6MHgzMzY1Qjc2MjY3YzU1RkNCMDA0ZDhhMWI4NzkwZjY0MTQ5NzY5OUNkXCIsXCJzdWJcIjpcIlI2c2twbXBFaWMwdXowSENkempvUDBXS3lDZjhsRWxjbW1wY3hqNVJjZlE9XCIsXCJhdWRcIjpcIjgyMm5TWWxvSVl1ZXpYeWFSVzFmR0Jsb0Q3V2xWakluT3kzZkQ0ZFFZRUk9XCIsXCJuYmZcIjoxNjIxNjQyNzQyLFwidGlkXCI6XCJiOTA1OGIxNi1iZDVkLTQ0ZTUtOTQ0Yy1iODdhODI5ZjMwZjBcIixcImFkZFwiOlwiMHg2OGM5NDc2YjBjMjc5ZmM0OGJjMjA5NWU2NTQxODAwOGE5YTZhYWQyMGZiODU5MTJhNmZmODZmYzk1NGNlNzc5NGUyMWUwYjJlZDM0NTdiOTEzNzliMTJhM2EwOTJjY2UxYWNiYTBkODViZWE1YmQzNjQ2MjVkOTliYzZkNThkNzFjXCJ9Il0='\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"token='WyIweGNhZmYyYzNlZGVhMzQwMjZhMjkyMzlmZGU5OGNmOGMyZDA5YTQzNGUyMDQzOTAyYTU5N2FmMGFlMjljYWFiMTQ3MTcyZGNlM2Y3MzJkMjVlMGU5MWI4YjQ4OTMwYWYyYmMxZTU2NDEyZjY4NmJmMzhmMjRlMjdhMGEzYzQ5ZDRlMWMiLCJ7XCJpYXRcIjoxNjIxNjQyNzQyLFwiZXh0XCI6MTYyMTY0MzY0MixcImlzc1wiOlwiZGlkOmV0aHI6MHgzMzY1Qjc2MjY3YzU1RkNCMDA0ZDhhMWI4NzkwZjY0MTQ5NzY5OUNkXCIsXCJzdWJcIjpcIlI2c2twbXBFaWMwdXowSENkempvUDBXS3lDZjhsRWxjbW1wY3hqNVJjZlE9XCIsXCJhdWRcIjpcIjgyMm5TWWxvSVl1ZXpYeWFSVzFmR0Jsb0Q3V2xWakluT3kzZkQ0ZFFZRUk9XCIsXCJuYmZcIjoxNjIxNjQyNzQyLFwidGlkXCI6XCJiOTA1OGIxNi1iZDVkLTQ0ZTUtOTQ0Yy1iODdhODI5ZjMwZjBcIixcImFkZFwiOlwiMHg2OGM5NDc2YjBjMjc5ZmM0OGJjMjA5NWU2NTQxODAwOGE5YTZhYWQyMGZiODU5MTJhNmZmODZmYzk1NGNlNzc5NGUyMWUwYjJlZDM0NTdiOTEzNzliMTJhM2EwOTJjY2UxYWNiYTBkODViZWE1YmQzNjQ2MjVkOTliYzZkNThkNzFjXCJ9Il0='\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"!!! important\nThis token revocation is not implemented yet !"}]},{"type":"element","tag":"h2","props":{"id":"jwt-refresh-token"},"children":[{"type":"text","value":"JWT refresh token"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Expire at a time delta of "},{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"conf.JWT_REFRESH_TOKEN_EXPIRE_DAYS"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Sample payload :"}]},{"type":"element","tag":"pre","props":{"code":"email: bob@acme.com\ndomain: uat.paxpar.tech\ntype: refresh\nid: 0084c018-e7d9-489b-9a3c-d40f72b3858c\n","language":"yaml","meta":"","className":"language-yaml shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"color:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"email"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"bob@acme.com"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"color:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"domain"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"uat.paxpar.tech"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"color:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"type"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"refresh"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"color:#22863A;--shiki-dark:#85E89D"},"children":[{"type":"text","value":"id"}]},{"type":"element","tag":"span","props":{"style":"color:#24292E;--shiki-dark:#E1E4E8"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":"0084c018-e7d9-489b-9a3c-d40f72b3858c"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"id"}]},{"type":"text","value":" is a standard uuid4."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"!!! important\nThis refresh token revocation is not implemented yet !"}]},{"type":"element","tag":"h2","props":{"id":"service-authentication"},"children":[{"type":"text","value":"Service authentication"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Requests between services are alos protected by JWT tokens."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Each client service need to be authenticated to get a valid token."}]},{"type":"element","tag":"h2","props":{"id":"service-privilege-escalation"},"children":[{"type":"text","value":"Service privilege escalation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use case :\nan API call from an unprivileged account need in turn to call\na more privileged API."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this case we need a new token with more privileges (scopes) by escalating it."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The API call is "},{"type":"element","tag":"a","props":{"href":"/api/docs#/auth/token_esclation_api_auth_token_escalate_post"},"children":[{"type":"text","value":"/api/auth/token/escalate"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"service-impersonation"},"children":[{"type":"text","value":"Service impersonation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Use case :\nan API call from an admin account that need in turn to call\nan API as a user."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this case we need to "},{"type":"element","tag":"a","props":{"href":"https://stackoverflow.com/questions/41747705/impersonation-using-jwt","rel":["nofollow"]},"children":[{"type":"text","value":"impersonate the JWT token"}]},{"type":"text","value":"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The API call is "},{"type":"element","tag":"a","props":{"href":"/api/docs#/auth/token_esclation_api_auth_token_impersonate_post"},"children":[{"type":"text","value":"/api/auth/token/impersonate"}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"roles-and-scopes"},"children":[{"type":"text","value":"Roles and scopes"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"me : Everything about me (the current user)"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"admin : Everything about all users and reference objects"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"api.core.auth :"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"api.core.auth.escalation"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"api.core.auth.impersonation"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"api.core.check"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"api.core.craft"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"api.core.sign"}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html.dark .shiki span {color: var(--shiki-dark) !important;background: var(--shiki-dark-bg) !important;font-style: var(--shiki-dark-font-style) !important;font-weight: var(--shiki-dark-font-weight) !important;text-decoration: var(--shiki-dark-text-decoration) !important;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"url-sequence-v3","depth":2,"text":"URL sequence v3"},{"id":"url-sequence-v2","depth":2,"text":"URL sequence v2"},{"id":"url-sequence-v1","depth":2,"text":"URL sequence v1"},{"id":"obsolete","depth":2,"text":"obsolete ??"},{"id":"local-dev-session","depth":2,"text":"local dev session"},{"id":"misc","depth":2,"text":"misc"},{"id":"pg-admin","depth":2,"text":"pg admin"},{"id":"jwt-token","depth":2,"text":"JWT token"},{"id":"user-authentication","depth":2,"text":"User authentication"},{"id":"jwt-token-1","depth":2,"text":"JWT token"},{"id":"jwt-refresh-token","depth":2,"text":"JWT refresh token"},{"id":"service-authentication","depth":2,"text":"Service authentication"},{"id":"service-privilege-escalation","depth":2,"text":"Service privilege escalation"},{"id":"service-impersonation","depth":2,"text":"Service impersonation"},{"id":"roles-and-scopes","depth":2,"text":"Roles and scopes"}]}},"_type":"markdown","_id":"content:10.docs:80.team:10.services:auth:index.md","_source":"content","_file":"10.docs/80.team/10.services/auth/index.md","_extension":"md"}