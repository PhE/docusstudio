{"_path":"/docs/team/serveurs/serveur-uat","_dir":"serveurs","_draft":false,"_partial":false,"_locale":"","title":"UAT","description":"","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"uat"},"children":[{"type":"text","value":"UAT"}]},{"type":"element","tag":"h1","props":{"id":"responsable"},"children":[{"type":"text","value":"Responsable"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Éric Forgeot ("},{"type":"element","tag":"a","props":{"href":"mailto:eric@paxpar.tech"},"children":[{"type":"text","value":"eric@paxpar.tech"}]},{"type":"text","value":"), tel 06 83 59 42 90 (préférez les SMS si urgence)"}]}]},{"type":"element","tag":"h1","props":{"id":"utilisation"},"children":[{"type":"text","value":"Utilisation"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Tests de Paxpar "},{"type":"element","tag":"a","props":{"href":"https://uat.paxpar.tech/","rel":["nofollow"]},"children":[{"type":"text","value":"https://uat.paxpar.tech/"}]}]}]},{"type":"element","tag":"h2","props":{"id":"historique-serveur-uat-paxpar"},"children":[{"type":"text","value":"Historique serveur UAT Paxpar"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"2021-07-09 : migration UAT du serveur Saturne vers serveur Victoire"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"2021-09-07 : remigration UAT vers serveur Pluton (PROD), sur namespace dédié"}]}]},{"type":"element","tag":"h1","props":{"id":"installation"},"children":[{"type":"text","value":"Installation"}]},{"type":"element","tag":"h2","props":{"id":"installation-k8s"},"children":[{"type":"text","value":"Installation K8S"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"installation classique avec CI/CD (comme pour PROD)"}]}]},{"type":"element","tag":"h3","props":{"id":"certificat"},"children":[{"type":"text","value":"Certificat"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Si le certificat bloque, utiliser les exemples issus de :"}]},{"type":"element","tag":"pre","props":{"code":"paxpar/docs/deploy/deploy_paxpar/cert_issuer_paxpar.yaml\npaxpar/docs/deploy/deploy_paxpar/cert_ingress_paxpar.yaml\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"paxpar/docs/deploy/deploy_paxpar/cert_issuer_paxpar.yaml\npaxpar/docs/deploy/deploy_paxpar/cert_ingress_paxpar.yaml\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"adapter si nécessaire, et relancer le certificat ainsi :"}]},{"type":"element","tag":"pre","props":{"code":"kubectl apply -f cert_ingress_paxpar.yaml -n paxpar-uat\nkubectl apply -f cert_issuer_paxpar.yaml\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"kubectl apply -f cert_ingress_paxpar.yaml -n paxpar-uat\nkubectl apply -f cert_issuer_paxpar.yaml\n"}]}]},{"type":"element","tag":"h2","props":{"id":"installation-ancienne-ceci-concerne-lancienne-version-de-uat-qui-était-sur-le-serveur-de-dev"},"children":[{"type":"text","value":"Installation ancienne (ceci concerne l'ancienne version de UAT qui était sur le serveur de DEV)"}]},{"type":"element","tag":"h2","props":{"id":"installer-byobu"},"children":[{"type":"text","value":"Installer byobu"}]},{"type":"element","tag":"pre","props":{"code":"apt update\napt install byobu\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"color:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"apt"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" update"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"color:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"apt"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" install"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" byobu"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"désactiver-certains-services"},"children":[{"type":"text","value":"Désactiver certains services"}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"systemctl disable snmpd"}]}]},{"type":"element","tag":"h2","props":{"id":"installation-serveur"},"children":[{"type":"text","value":"Installation serveur"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Ici est décrit le déploiement UAT.\nVoir "},{"type":"element","tag":"a","props":{"href":"serveur-Prod"},"children":[{"type":"text","value":"cette page"}]},{"type":"text","value":" pour le déploiement en prod."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Installation et conf de base :"}]},{"type":"element","tag":"pre","props":{"code":"# outils client\nbash <(curl -s https://gitlab.com/phec.net/edouard/-/raw/v0.3.0/k8scli/install.sh)\n# microk8s et addons\nbash <(curl -s https://gitlab.com/phec.net/edouard/-/raw/v0.3.0/microk8s/install.sh)\n# ingres et cert-manager\nbash <(curl -s https://gitlab.com/phec.net/edouard/-/raw/v0.3.0/microk8s/ingress-cert-manager.sh)\n","language":"bash","meta":"","className":"language-bash shiki shiki-themes github-light github-dark","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"color:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# outils client"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"color:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"bash"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" <("}]},{"type":"element","tag":"span","props":{"style":"color:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"span","props":{"style":"color:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -s"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" https://gitlab.com/phec.net/edouard/-/raw/v0.3.0/k8scli/install.sh)"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"color:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# microk8s et addons"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"color:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"bash"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" <("}]},{"type":"element","tag":"span","props":{"style":"color:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"span","props":{"style":"color:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -s"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" https://gitlab.com/phec.net/edouard/-/raw/v0.3.0/microk8s/install.sh)"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"color:#6A737D;--shiki-dark:#6A737D"},"children":[{"type":"text","value":"# ingres et cert-manager"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"color:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"bash"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" <("}]},{"type":"element","tag":"span","props":{"style":"color:#6F42C1;--shiki-dark:#B392F0"},"children":[{"type":"text","value":"curl"}]},{"type":"element","tag":"span","props":{"style":"color:#005CC5;--shiki-dark:#79B8FF"},"children":[{"type":"text","value":" -s"}]},{"type":"element","tag":"span","props":{"style":"color:#032F62;--shiki-dark:#9ECBFF"},"children":[{"type":"text","value":" https://gitlab.com/phec.net/edouard/-/raw/v0.3.0/microk8s/ingress-cert-manager.sh)"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"déploiement-paxpar-uat"},"children":[{"type":"text","value":"Déploiement paxpar UAT"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"URL de déploiement par défaut : "},{"type":"element","tag":"a","props":{"href":"https://uat.paxpar.tech/","rel":["nofollow"]},"children":[{"type":"text","value":"https://uat.paxpar.tech/"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Créer/modifier le fichier deploy/paxpar/values_dev_override.yaml :"}]},{"type":"element","tag":"pre","props":{"code":"ingress:\n  annotations:\n    cert-manager.io/issuer: \"letsencrypt-prod\"\n\nextraEnv:\n  - name: PP_ENV\n    value: DEV\n  - name: PP_CHAT_URL\n    value: https://paxpar.tech/matter/api/v4/\n  - name: PP_CHAT_USER\n    value: ludovic\n  - name: PP_CHAT_PASSWORD\n    value: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"ingress:\n  annotations:\n    cert-manager.io/issuer: \"letsencrypt-prod\"\n\nextraEnv:\n  - name: PP_ENV\n    value: DEV\n  - name: PP_CHAT_URL\n    value: https://paxpar.tech/matter/api/v4/\n  - name: PP_CHAT_USER\n    value: ludovic\n  - name: PP_CHAT_PASSWORD\n    value: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Puis lancer le déploiement avec :"}]},{"type":"element","tag":"pre","props":{"code":"skaffold -p uat run\n"},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"skaffold -p uat run\n"}]}]},{"type":"element","tag":"h1","props":{"id":"services-annexes"},"children":[{"type":"text","value":"Services annexes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Pour nettoyer les images docker, dans crontab :"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":""},"children":[{"type":"text","value":"00 22 * * 7 /usr/bin/docker system prune -af > /tmp/docker_prune.log"}]}]},{"type":"element","tag":"h1","props":{"id":"notes"},"children":[{"type":"text","value":"Notes"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Info anciennement sur "},{"type":"element","tag":"a","props":{"href":"https://gitlab.com/arundo-tech/paxpar/-/blob/master/docs/deploy/index.md","rel":["nofollow"]},"children":[{"type":"text","value":"https://gitlab.com/arundo-tech/paxpar/-/blob/master/docs/deploy/index.md"}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html.dark .shiki span {color: var(--shiki-dark) !important;background: var(--shiki-dark-bg) !important;font-style: var(--shiki-dark-font-style) !important;font-weight: var(--shiki-dark-font-weight) !important;text-decoration: var(--shiki-dark-text-decoration) !important;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"historique-serveur-uat-paxpar","depth":2,"text":"Historique serveur UAT Paxpar"},{"id":"installation-k8s","depth":2,"text":"Installation K8S","children":[{"id":"certificat","depth":3,"text":"Certificat"}]},{"id":"installation-ancienne-ceci-concerne-lancienne-version-de-uat-qui-était-sur-le-serveur-de-dev","depth":2,"text":"Installation ancienne (ceci concerne l'ancienne version de UAT qui était sur le serveur de DEV)"},{"id":"installer-byobu","depth":2,"text":"Installer byobu"},{"id":"désactiver-certains-services","depth":2,"text":"Désactiver certains services"},{"id":"installation-serveur","depth":2,"text":"Installation serveur"},{"id":"déploiement-paxpar-uat","depth":2,"text":"Déploiement paxpar UAT"}]}},"_type":"markdown","_id":"content:10.docs:80.team:serveurs:serveur-UAT.md","_source":"content","_file":"10.docs/80.team/serveurs/serveur-UAT.md","_extension":"md"}